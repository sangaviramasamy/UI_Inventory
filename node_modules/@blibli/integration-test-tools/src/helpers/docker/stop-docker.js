const playwrightConfig = require('./playwright')
const { execSync } = require('child_process')
const chalk = require('chalk')

const playwrightDocker = 'bliblidotcom/playwright-runner:' + playwrightConfig.dockerImageTag

const getIdCmd = 'docker ps -q --filter ancestor=' + playwrightDocker
const getStopCmd = id => 'docker stop ' + id

function dockerStop () {
  try {
    const idRaw = execSync(getIdCmd)
    const id = idRaw.toString().trim()
    if (!id) {
      console.log(chalk.yellow('No pod found with image: ' + playwrightDocker + '.', 'Exiting'))
      return
    }
    console.log(chalk.blue('Stopping docker pod: ' + id + '...'))
    execSync(getStopCmd(id))
    console.log(chalk.green('Pod ' + id + ' stopped successfully'))
  } catch (e) {
    console.error(chalk.red(e))
  }
}

module.exports = {
  dockerStop
}
