const { spawn } = require('../../utils/proc')
const pathUtil = require('../../utils/path')
const { app: appConfig, mainUi } = require('../blibli-integration-test.config')
const path = require('path')
const { mainRun } = require('../collab/main')
const { dockerRun } = require('../docker')

const exeFile = path.join(pathUtil.module.path, 'bin', 'index.js')

function appsRun (params) {
  const collabArgs = ['run', appConfig.script]

  const procs = mainUi ? [mainRun(params)] : []
  procs.push(spawn('npm', collabArgs))
  return procs
}

function appsRunLocal ({ args = {} } = {}) {
  const dockerArgs = [exeFile, 'docker:run', ...args]

  return [
    ...appsRun({ args }),
    dockerRun()
  ]
}

module.exports = {
  appsRun,
  appsRunLocal
}
